<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false&libraries=drawing"></script>

<script type="text/javascript">
var map;
var point;

function initialize() {
  console.log("Initializing..");
  // Create a map, center it
  map = new google.maps.Map(document.getElementById('map_canvas'),{ zoom: 2, mapTypeId: google.maps.MapTypeId.ROADMAP });
  map.setCenter(new google.maps.LatLng(0,0));
  var drawingManager = new google.maps.drawing.DrawingManager({
    drawingMode: google.maps.drawing.OverlayType.CIRCLE,
    drawingControl: true,
    drawingControlOptions: {
    position: google.maps.ControlPosition.TOP_CENTER,
    drawingModes: [google.maps.drawing.OverlayType.CIRCLE]
    },
    circleOptions: {
    fillColor: '#ffff00',
    fillOpacity: 0.4,
    strokeWeight: 1,
    clickable: false,
    zIndex: 1,
    editable: false
    }
  });
  drawingManager.setMap(map);
  function densityToColor(i, r) {
    return colorToHex('rgb('+Math.floor((i+50)/r) +1+', ' + Math.floor((i+50)/r) + ', ' + Math.floor((i + 50)/r) + ')');
  }
  google.maps.event.addListener(drawingManager, 'circlecomplete', function(circle) {
    var lat = circle.getCenter().Pa
    var lng = circle.getCenter().Qa
    var radius = circle.getRadius()
    $.get('/api/demo/itemDensity', {latitude: lat, longitude: lng, distance: radius}, 
      function(data) {
        circle.fillColor = densityToColor(data.density, radius);
        circle.setMap(map);
      });
  });
  // http://haacked.com/archive/2009/12/29/convert-rgb-to-hex.aspx
  function colorToHex(color) {
    if (color.substr(0, 1) === '#') {
      return color;
    }
    var digits = /(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(color);

    var red = parseInt(digits[2]);
    var green = parseInt(digits[3]);
    var blue = parseInt(digits[4]);

    var rgb = blue | (green << 8) | (red << 16);
    return digits[1] + '#' + rgb.toString(16);
  };
}


google.maps.event.addDomListener(window, 'load', initialize);

</script>
<div style="width:600px; height:600px;"> 
<div id="map_canvas" style="width:100%; height:100%"></div> 
</div> 

